<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Ohio Polygon Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>#map { height: 100vh; margin: 0; }</style>
</head>
<body>
<div id="map"></div>

<script>
const map = L.map('map').setView([40, -82.9], 7);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19}).addTo(map);

// optional private data
let privateData = {};
fetch("https://company.sharepoint.com/sites/team/secure/polygon_data.json")
  .then(r => r.json())
  .then(d => d.forEach(x => privateData[x.id] = x))
  .catch(() => console.warn("Private data unavailable or access restricted"));

// get polygon ID from URL (e.g. /OH/polygon1)
const pathParts = window.location.pathname.split("/");
const polygonId = pathParts[pathParts.length - 1] || null;

// load GeoJSON for Ohio
fetch("geojson/oh.geojson")
  .then(r => r.json())
  .then(data => {
    // show all polygons first
    const all = L.geoJSON(data, { style: { color: "blue", weight: 1 } }).addTo(map);

    if (polygonId) {
      const target = data.features.find(f => f.properties.id === polygonId);
      if (target) {
        const single = L.geoJSON(target, { style: { color: "red", weight: 2 } }).addTo(map);
        map.fitBounds(single.getBounds());

        const info = privateData[target.properties.id];
        const html = info
          ? `<b>${info.name}</b><br>Size: ${info.size}`
          : `<b>${target.properties.label}</b><br><i>Details unavailable.</i>`;
        single.bindPopup(html).openPopup();
      } else {
        alert(`Polygon '${polygonId}' not found.`);
      }
    }
  });
</script>
</body>
</html>
